// –ü–æ–ª—É—á–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ canvas –∏ –∫–Ω–æ–ø–æ–∫
const canvas = document.querySelector("#paintField"); // –≠–ª–µ–º–µ–Ω—Ç canvas, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–º –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ä–∏—Å–æ–≤–∞–Ω–∏–µ
const clearBtn = document.querySelector("#clear"); // –ö–Ω–æ–ø–∫–∞ –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –ø–æ–ª—è
const sadBtn = document.querySelector("#sad"); // –ö–Ω–æ–ø–∫–∞ –¥–ª—è –æ—Ç–º–µ—Ç–∫–∏ –≥—Ä—É—Å—Ç–Ω–æ–≥–æ —Ä–∏—Å—É–Ω–∫–∞
const happyBtn = document.querySelector("#happy"); // –ö–Ω–æ–ø–∫–∞ –¥–ª—è –æ—Ç–º–µ—Ç–∫–∏ —Å—á–∞—Å—Ç–ª–∏–≤–æ–≥–æ —Ä–∏—Å—É–Ω–∫–∞
const angryBtn = document.querySelector("#angry"); // –ö–Ω–æ–ø–∫–∞ –¥–ª—è –æ—Ç–º–µ—Ç–∫–∏ –∑–ª–æ–≥–æ —Ä–∏—Å—É–Ω–∫–∞
const surprisedBtn = document.querySelector("#surprised"); // –ö–Ω–æ–ø–∫–∞ –¥–ª—è –æ—Ç–º–µ—Ç–∫–∏ —É–¥–∏–≤–ª–µ–Ω–Ω–æ–≥–æ —Ä–∏—Å—É–Ω–∫–∞
const trainBtn = document.querySelector("#train"); // –ö–Ω–æ–ø–∫–∞ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –æ–±—É—á–µ–Ω–∏—è –Ω–µ–π—Ä–æ–Ω–Ω–æ–π —Å–µ—Ç–∏
const predictBtn = document.querySelector("#predict"); // –ö–Ω–æ–ø–∫–∞ –¥–ª—è –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–µ–∫—É—â–µ–≥–æ —Ä–∏—Å—É–Ω–∫–∞
const saveBtn = document.querySelector("#save"); // –ö–Ω–æ–ø–∫–∞ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
const loadInput = document.querySelector("#load"); // –≠–ª–µ–º–µ–Ω—Ç input –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö

// –ö–æ–Ω—Ç–µ–∫—Å—Ç —Ä–∏—Å–æ–≤–∞–Ω–∏—è –Ω–∞ canvas
const ctx = canvas.getContext("2d");

// –ú–∞—Å—Å–∏–≤ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ä–∏—Å–æ–≤–∞–Ω–∏—è (10x10 –ø–∏–∫—Å–µ–ª–µ–π)
const paintField = new Array(100).fill(false);

// –ú–∞—Å—Å–∏–≤ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ–±—É—á–µ–Ω–∏—è –º–æ–¥–µ–ª–∏
const trainData = [];

// –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
let mouseDown = false; // –§–ª–∞–≥ –Ω–∞–∂–∞—Ç–∏—è –º—ã—à–∏
let happyCount = 0; // –°—á–µ—Ç—á–∏–∫ —Å—á–∞—Å—Ç–ª–∏–≤—ã—Ö —Ä–∏—Å—É–Ω–∫–æ–≤
let sadCount = 0; // –°—á–µ—Ç—á–∏–∫ –≥—Ä—É—Å—Ç–Ω—ã—Ö —Ä–∏—Å—É–Ω–∫–æ–≤
let angryCount = 0; // –°—á–µ—Ç—á–∏–∫ –∑–ª—ã—Ö —Ä–∏—Å—É–Ω–∫–æ–≤
let surprisedCount = 0; // –°—á–µ—Ç—á–∏–∫ —É–¥–∏–≤–ª–µ–Ω–Ω—ã—Ö —Ä–∏—Å—É–Ω–∫–æ–≤

/**
 * –†–∏—Å—É–µ—Ç —Å–µ—Ç–∫—É –Ω–∞ canvas.
 */
function drawGrid() {
  ctx.strokeStyle = "#CCC"; // –¶–≤–µ—Ç –ª–∏–Ω–∏–π —Å–µ—Ç–∫–∏

  for (let i = 1; i < 10; i++) {
    // –†–∏—Å–æ–≤–∞–Ω–∏–µ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã—Ö –∏ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã—Ö –ª–∏–Ω–∏–π —Å–µ—Ç–∫–∏
    ctx.moveTo(0, i * 40);
    ctx.lineTo(400, i * 40);
    ctx.moveTo(i * 40, 0);
    ctx.lineTo(i * 40, 400);
  }

  ctx.stroke(); // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –Ω–∞ canvas
}

/**
 * –û—á–∏—â–∞–µ—Ç canvas –∏ –ø–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ—Ç —Å–µ—Ç–∫—É.
 */
function clearCanvas() {
  ctx.fillStyle = "#FFF"; // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–µ–ª–æ–≥–æ —Ñ–æ–Ω–∞
  ctx.fillRect(0, 0, 400, 400); // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –≤—Å–µ–≥–æ canvas –±–µ–ª—ã–º —Ü–≤–µ—Ç–æ–º
  drawGrid(); // –†–∏—Å–æ–≤–∞–Ω–∏–µ —Å–µ—Ç–∫–∏
}

/**
 * –†–∏—Å—É–µ—Ç –∫–≤–∞–¥—Ä–∞—Ç –∑–∞–¥–∞–Ω–Ω–æ–≥–æ —Ü–≤–µ—Ç–∞ –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–π —è—á–µ–π–∫–µ –Ω–∞ canvas.
 * @param {number} row - –ù–æ–º–µ—Ä —Å—Ç—Ä–æ–∫–∏ —è—á–µ–π–∫–∏
 * @param {number} column - –ù–æ–º–µ—Ä —Å—Ç–æ–ª–±—Ü–∞ —è—á–µ–π–∫–∏
 * @param {string} color - –¶–≤–µ—Ç –¥–ª—è –∑–∞–ª–∏–≤–∫–∏ –∫–≤–∞–¥—Ä–∞—Ç–∞
 */
function drawSquare(row, column, color) {
  ctx.fillStyle = color; // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ü–≤–µ—Ç–∞ –∑–∞–ª–∏–≤–∫–∏
  ctx.fillRect(column * 40 + 1, row * 40 + 1, 38, 38); // –†–∏—Å–æ–≤–∞–Ω–∏–µ –∫–≤–∞–¥—Ä–∞—Ç–∞ –≤ –∑–∞–¥–∞–Ω–Ω—ã—Ö –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞—Ö
}

/**
 * –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è –¥–ª—è —Ä–∏—Å–æ–≤–∞–Ω–∏—è –Ω–∞ canvas –ø—Ä–∏ –¥–≤–∏–∂–µ–Ω–∏–∏ –º—ã—à–∏.
 * @param {MouseEvent} event - –°–æ–±—ã—Ç–∏–µ –º—ã—à–∏
 */
function draw(event) {
  // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∫—É—Ä—Å–æ—Ä–∞ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö —Ö–æ–ª—Å—Ç–∞
  const offsetX = Math.min(Math.max(event.offsetX, 0), 399);
  const offsetY = Math.min(Math.max(event.offsetY, 0), 399);

  const rowIndex = Math.floor(offsetY / 40); // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ –ø–æ –ø–æ–ª–æ–∂–µ–Ω–∏—é –º—ã—à–∏
  const columnIndex = Math.floor(offsetX / 40); // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ç–æ–ª–±—Ü–∞ –ø–æ –ø–æ–ª–æ–∂–µ–Ω–∏—é –º—ã—à–∏
  const arrayIndex = rowIndex * 10 + columnIndex; // –ò–Ω–¥–µ–∫—Å –≤ –º–∞—Å—Å–∏–≤–µ paintField

  // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –≤—ã—Ö–æ–¥–∏—Ç –ª–∏ –∏–Ω–¥–µ–∫—Å –∑–∞ –≥—Ä–∞–Ω–∏—Ü—ã –º–∞—Å—Å–∏–≤–∞
  if (arrayIndex >= 0 && arrayIndex < paintField.length) {
    paintField[arrayIndex] = true; // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–Ω–∞—á–µ–Ω–∏—è true –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–π —è—á–µ–π–∫–∏
    drawSquare(rowIndex, columnIndex, "green"); // –†–∏—Å–æ–≤–∞–Ω–∏–µ –∑–µ–ª–µ–Ω–æ–≥–æ –∫–≤–∞–¥—Ä–∞—Ç–∞ –≤ –≤—ã–±—Ä–∞–Ω–Ω–æ–π —è—á–µ–π–∫–µ
  }
}

/**
 * –û—á–∏—â–∞–µ—Ç –ø–æ–ª–µ —Ä–∏—Å–æ–≤–∞–Ω–∏—è (paintField).
 */
function clearField() {
  paintField.fill(false); // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –º–∞—Å—Å–∏–≤–∞ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ false
  clearCanvas(); // –û—á–∏—Å—Ç–∫–∞ canvas
}

/**
 * –û–±–Ω–æ–≤–ª—è–µ—Ç —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–æ–∫ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å—á–∞—Å—Ç–ª–∏–≤—ã—Ö, –≥—Ä—É—Å—Ç–Ω—ã—Ö, –∑–ª—ã—Ö –∏ —É–¥–∏–≤–ª–µ–Ω–Ω—ã—Ö —Ä–∏—Å—É–Ω–∫–æ–≤.
 */
function updateInterface() {
  happyBtn.innerText = `üòÄ ${happyCount}`; // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –∫–Ω–æ–ø–∫–∏ happy
  sadBtn.innerText = `üôÅ ${sadCount}`; // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –∫–Ω–æ–ø–∫–∏ sad
  angryBtn.innerText = `üò° ${angryCount}`; // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –∫–Ω–æ–ø–∫–∏ angry
  surprisedBtn.innerText = `üò≤ ${surprisedCount}`; // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –∫–Ω–æ–ø–∫–∏ surprised
}

/**
 * –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ä–∏—Å—É–Ω–∫–∞ –∏ –µ–≥–æ –º–µ—Ç–∫—É –≤ –º–∞—Å—Å–∏–≤ –¥–∞–Ω–Ω—ã—Ö –æ–±—É—á–µ–Ω–∏—è.
 * @param {number[]} value - –ú–µ—Ç–∫–∞ —Ä–∏—Å—É–Ω–∫–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, [1, 0, 0, 0] –¥–ª—è —Å—á–∞—Å—Ç–ª–∏–≤–æ–≥–æ, [0, 1, 0, 0] –¥–ª—è –≥—Ä—É—Å—Ç–Ω–æ–≥–æ)
 */
function storeResult(value) {
  trainData.push({ paintField: [...paintField], label: value }); // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ –º–∞—Å—Å–∏–≤ trainData
  if (value[0] === 1) happyCount++; // –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ —Å—á–∞—Å—Ç–ª–∏–≤—ã—Ö —Ä–∏—Å—É–Ω–∫–æ–≤
  else if (value[1] === 1) sadCount++; // –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ –≥—Ä—É—Å—Ç–Ω—ã—Ö —Ä–∏—Å—É–Ω–∫–æ–≤
  else if (value[2] === 1) angryCount++; // –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ –∑–ª—ã—Ö —Ä–∏—Å—É–Ω–∫–æ–≤
  else if (value[3] === 1) surprisedCount++; // –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ —É–¥–∏–≤–ª–µ–Ω–Ω—ã—Ö —Ä–∏—Å—É–Ω–∫–æ–≤
  updateInterface(); // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
  clearField(); // –û—á–∏—Å—Ç–∫–∞ –ø–æ–ª—è —Ä–∏—Å–æ–≤–∞–Ω–∏—è
}

// –î–æ–±–∞–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –æ–±—É—á–µ–Ω–∏—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON
function saveTrainingData() {
  const jsonData = JSON.stringify(trainData); // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –º–∞—Å—Å–∏–≤ trainData –≤ JSON —Å—Ç—Ä–æ–∫—É
  const blob = new Blob([jsonData], { type: 'application/json' }); // –°–æ–∑–¥–∞–µ–º Blob –∏–∑ JSON —Å—Ç—Ä–æ–∫–∏
  const url = URL.createObjectURL(blob); // –°–æ–∑–¥–∞–µ–º URL –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è Blob

  const a = document.createElement('a'); // –°–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç <a> –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞
  a.href = url; // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º URL –≤ –∞—Ç—Ä–∏–±—É—Ç href
  a.download = 'trainData.json'; // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–º—è —Ñ–∞–π–ª–∞ –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
  document.body.appendChild(a); // –î–æ–±–∞–≤–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç <a> –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É
  a.click(); // –ò–º–∏—Ç–∏—Ä—É–µ–º –∫–ª–∏–∫ –ø–æ —ç–ª–µ–º–µ–Ω—Ç—É <a> –¥–ª—è –Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞

  // –û—á–∏—â–∞–µ–º URL –∏ —É–¥–∞–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç <a> –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞
  setTimeout(() => {
    URL.revokeObjectURL(url); // –û—Å–≤–æ–±–æ–∂–¥–∞–µ–º —Ä–µ—Å—É—Ä—Å—ã URL
    document.body.removeChild(a); // –£–¥–∞–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç <a> —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    alert("–î–∞–Ω–Ω—ã–µ –æ–±—É—á–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ —Ñ–∞–π–ª trainData.json!"); // –í—ã–≤–æ–¥–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—à–Ω–æ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏
  }, 0);
}

// –î–æ–±–∞–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –æ–±—É—á–µ–Ω–∏—è –∏–∑ —Ñ–∞–π–ª–∞ JSON
function loadTrainingData(event) {
  const file = event.target.files[0]; 
  const reader = new FileReader(); 

  reader.onload = function (e) {
    const jsonData = e.target.result; // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª–∞ –≤ –≤–∏–¥–µ —Ç–µ–∫—Å—Ç–∞
    const loadedData = JSON.parse(jsonData); // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º JSON —Å—Ç—Ä–æ–∫—É –≤ JavaScript –æ–±—ä–µ–∫—Ç
    trainData.push(...loadedData); // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ –º–∞—Å—Å–∏–≤ trainData
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫–∏ —ç–º–æ—Ü–∏–π –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
    loadedData.forEach(data => {
      if (data.label[0] === 1) happyCount++; // –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ —Å—á–∞—Å—Ç–ª–∏–≤—ã—Ö —Ä–∏—Å—É–Ω–∫–æ–≤
      if (data.label[1] === 1) sadCount++; // –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ –≥—Ä—É—Å—Ç–Ω—ã—Ö —Ä–∏—Å—É–Ω–∫–æ–≤
      if (data.label[2] === 1) angryCount++; // –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ –∑–ª—ã—Ö —Ä–∏—Å—É–Ω–∫–æ–≤
      if (data.label[3] === 1) surprisedCount++; // –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ —É–¥–∏–≤–ª–µ–Ω–Ω—ã—Ö —Ä–∏—Å—É–Ω–∫–æ–≤
    });
    
    updateInterface(); // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö
    alert("–î–∞–Ω–Ω—ã–µ –æ–±—É—á–µ–Ω–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω—ã!"); // –í—ã–≤–æ–¥–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—à–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–µ
  };

  reader.readAsText(file); // –ß–∏—Ç–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ –∫–∞–∫ —Ç–µ–∫—Å—Ç
}

// –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è –¥–ª—è —ç–ª–µ–º–µ–Ω—Ç–∞ input –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö
loadInput.addEventListener('change', loadTrainingData);

// –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –º—ã—à—å—é –∏ –∫–Ω–æ–ø–∫–∞–º–∏
document.addEventListener("mousedown", () => (mouseDown = true)); // –ù–∞–∂–∞—Ç–∏–µ –∫–Ω–æ–ø–∫–∏ –º—ã—à–∏
document.addEventListener("mouseup", () => (mouseDown = false)); // –û—Ç–ø—É—Å–∫–∞–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ –º—ã—à–∏

canvas.addEventListener("mousemove", (e) => {
  if (mouseDown) draw(e); // –í—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∏—Å–æ–≤–∞–Ω–∏—è –ø—Ä–∏ –Ω–∞–∂–∞—Ç–æ–π –∫–Ω–æ–ø–∫–µ –º—ã—à–∏
});

clearBtn.addEventListener("click", clearField); // –û—á–∏—Å—Ç–∫–∞ –ø–æ–ª—è —Ä–∏—Å–æ–≤–∞–Ω–∏—è

happyBtn.addEventListener("click", () => {
  storeResult([1, 0, 0, 0]); // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ —Ä–∏—Å—É–Ω–∫–∞ –∫–∞–∫ —Å—á–∞—Å—Ç–ª–∏–≤–æ–≥–æ
});

sadBtn.addEventListener("click", () => {
  storeResult([0, 1, 0, 0]); // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ —Ä–∏—Å—É–Ω–∫–∞ –∫–∞–∫ –≥—Ä—É—Å—Ç–Ω–æ–≥–æ
});

angryBtn.addEventListener("click", () => {
  storeResult([0, 0, 1, 0]); // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ —Ä–∏—Å—É–Ω–∫–∞ –∫–∞–∫ –∑–ª–æ–≥–æ
});

surprisedBtn.addEventListener("click", () => {
  storeResult([0, 0, 0, 1]); // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ —Ä–∏—Å—É–Ω–∫–∞ –∫–∞–∫ —É–¥–∏–≤–ª–µ–Ω–Ω–æ–≥–æ
});

predictBtn.addEventListener("click", () => {
  const inputTensor = preprocessDrawing(paintField);
  const prediction = model.predict(inputTensor);
  const [happiness, sadness, anger, surprise] = prediction.dataSync();

  const emotions = ["—Å—á–∞—Å—Ç–ª–∏–≤–æ–µ", "–≥—Ä—É—Å—Ç–Ω–æ–µ", "–∑–ª–æ–µ", "—É–¥–∏–≤–ª–µ–Ω–Ω–æ–µ"];
  const scores = [happiness, sadness, anger, surprise];
  const maxIndex = scores.indexOf(Math.max(...scores));

  alert(
    `–Ø –¥—É–º–∞—é —ç—Ç–æ ${emotions[maxIndex]} –ª–∏—Ü–æ!\n–°—á–∞—Å—Ç—å–µ: ${Math.round(happiness * 100)}% –ì—Ä—É—Å—Ç—å: ${Math.round(sadness * 100)}% –ó–ª–æ—Å—Ç—å: ${Math.round(anger * 100)}% –£–¥–∏–≤–ª–µ–Ω–∏–µ: ${Math.round(surprise * 100)}%`
  );
});

trainBtn.addEventListener("click", () => {
  trainModel(trainData).then(() => {
    predictBtn.disabled = false;
    alert("–Ø –æ–±—É—á–∏–ª—Å—è!");
  });
});

saveBtn.addEventListener("click", saveTrainingData); // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ–±—É—á–µ–Ω–∏—è

// –ù–∞—á–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
updateInterface();
clearCanvas();